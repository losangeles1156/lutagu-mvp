# ğŸ§ª LUTAGU ä¿®å¾©é©—è­‰æ¸¬è©¦æŒ‡å—

**æ¸¬è©¦æ—¥æœŸ**: 2026-01-22
**æ¸¬è©¦ç›®çš„**: é©—è­‰å‰ç«¯ä¿®å¾©æ˜¯å¦æˆåŠŸ
**é è¨ˆæ¸¬è©¦æ™‚é–“**: 15-20 åˆ†é˜

---

## ğŸš€ æ¸¬è©¦å‰æº–å‚™

### Step 1: å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

```bash
cd /Users/zhuangzixian/Documents/LUTAGU_MVP
npm run dev
```

ç­‰å¾…ä¼ºæœå™¨å•Ÿå‹•,æ‡‰è©²çœ‹åˆ°:
```
âœ“ Ready in XXXms
â—‹ Local:   http://localhost:3000
```

### Step 2: é–‹å•Ÿç€è¦½å™¨ DevTools

1. é–‹å•Ÿ Chrome ç€è¦½å™¨
2. è¨ªå• `http://localhost:3000`
3. æŒ‰ `F12` æˆ–å³éµ â†’ "æª¢æŸ¥"
4. åˆ‡æ›åˆ° **Console** Tab
5. æ¸…ç©º Console (å³éµ â†’ Clear console)

---

## ğŸ“‹ æ¸¬è©¦é …ç›®æ¸…å–®

### âœ… æ¸¬è©¦ 1: L2 è³‡æ–™æµ Debug Logging

**ç›®æ¨™**: ç¢ºèª L2 è³‡æ–™æµçš„ debug è³‡è¨Šæ­£ç¢ºé¡¯ç¤º

**æ­¥é©Ÿ**:
1. åœ¨é¦–é é»æ“Š "ä¸Šé‡" æˆ– "æ±äº¬" é€²å…¥åœ°åœ–
2. é»æ“Šä»»æ„è»Šç«™ç¯€é»
3. æŸ¥çœ‹ Console è¼¸å‡º

**é æœŸçµæœ**:
```javascript
[NodeTabs] L2 Adapter - Source data: {
    nodeId: "odpt:Station:TokyoMetro.Ginza.Ueno",
    hasL2Status: true,  // âš ï¸ é—œéµæª¢æŸ¥é»
    lineStatusCount: 5, // âš ï¸ æ‡‰è©² > 0
    lineStatus: [...]   // âš ï¸ æ‡‰è©²æœ‰è³‡æ–™
}

[L2_Live] Received data: {
    id: "odpt:Station:TokyoMetro.Ginza.Ueno",
    hasL2: true,        // âš ï¸ é—œéµæª¢æŸ¥é»
    linesCount: 5,      // âš ï¸ æ‡‰è©² > 0
    lines: [...]
}
```

**åˆ¤æ–·æ¨™æº–**:
- âœ… **PASS**: `hasL2Status: true` ä¸” `lineStatusCount > 0`
- âš ï¸ **éƒ¨åˆ†é€šé**: `hasL2Status: true` ä½† `lineStatusCount: 0`
- âŒ **FAIL**: `hasL2Status: false`

**å¦‚æœå¤±æ•—**:
```javascript
// å¦‚æœçœ‹åˆ°:
hasL2Status: false
lineStatusCount: 0

// è¡¨ç¤ºå¾Œç«¯ API æœªè¿”å› l2_status è³‡æ–™
// éœ€è¦æª¢æŸ¥:
// 1. /api/nodes/[nodeId] çš„å›æ‡‰
// 2. è³‡æ–™åº« transit_dynamic_snapshot è¡¨
```

---

### âœ… æ¸¬è©¦ 2: L2_Live Fallback UI

**ç›®æ¨™**: ç¢ºèªæ”¹é€²å¾Œçš„ Fallback UI æ­£ç¢ºé¡¯ç¤º

**æ­¥é©Ÿ**:
1. é»æ“Šè»Šç«™ç¯€é»,é–‹å•Ÿå³å´é¢æ¿
2. åˆ‡æ›åˆ° "ç‹€æ…‹" (Live) Tab
3. è§€å¯Ÿé¡¯ç¤ºå…§å®¹

**æƒ…å¢ƒ A: æœ‰ L2 è³‡æ–™** (é æœŸçœ‹åˆ°)
```
âœ… åˆ—è»Šè·¯ç·šåˆ—è¡¨
âœ… æ¯æ¢è·¯ç·šé¡¯ç¤º:
   - è·¯ç·šåç¨± (å¦‚: éŠ€åº§ç·š)
   - ç‡Ÿé‹å•† (å¦‚: æ±äº¬ãƒ¡ãƒˆãƒ­)
   - é‹è¡Œç‹€æ…‹ (æ­£å¸¸/å»¶é²)
   - è·¯ç·šé¡è‰²æ¨™è¨˜
```

**æƒ…å¢ƒ B: ç„¡ L2 è³‡æ–™** (æ¸¬è©¦ Fallback UI)
```
âœ… æ‡‰è©²çœ‹åˆ°æ”¹é€²å¾Œçš„ UI:
   [åœ–ç¤º] âš¡ Zap icon (ç°è‰²åœ“å½¢èƒŒæ™¯)

   æ¨™é¡Œ: "æš«ç„¡å³æ™‚é‹è¡Œæ•¸æ“š"
   (æ–‡å­—: 14px, æ·±ç°è‰², ç²—é«”)

   æè¿°: "è«‹ç¨å¾Œé‡è©¦æˆ–é¸æ“‡å…¶ä»–è»Šç«™"
   (æ–‡å­—: 12px, æ·ºç°è‰²)
```

**åˆ¤æ–·æ¨™æº–**:
- âœ… **PASS**: Fallback UI ç¾è§€,æœ‰åœ–ç¤ºã€æ¨™é¡Œã€æè¿°
- âš ï¸ **éƒ¨åˆ†é€šé**: æœ‰é¡¯ç¤ºä½†æ¨£å¼ä¸å®Œæ•´
- âŒ **FAIL**: åªé¡¯ç¤ºç°¡å–®çš„ "No live line data available"

**æˆªåœ–å°æ¯”**:

ä¿®å¾©å‰ âŒ:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         â”‚
â”‚  No live line data      â”‚
â”‚  available              â”‚
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ä¿®å¾©å¾Œ âœ…:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       [âš¡ åœ–ç¤º]          â”‚
â”‚                         â”‚
â”‚  æš«ç„¡å³æ™‚é‹è¡Œæ•¸æ“š        â”‚
â”‚  è«‹ç¨å¾Œé‡è©¦æˆ–é¸æ“‡å…¶ä»–è»Šç«™â”‚
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### âœ… æ¸¬è©¦ 3: Hub ç¯€é»åœ–ç¤ºé¡¯ç¤º

**ç›®æ¨™**: ç¢ºèªæ‰€æœ‰ Hub ç¯€é»é¡¯ç¤ºçš‡å† åœ–ç¤º ğŸ‘‘

**æ­¥é©Ÿ**:
1. åœ¨é¦–é é»æ“Š "ä¸Šé‡" é€²å…¥åœ°åœ–
2. è§€å¯Ÿåœ°åœ–ä¸Šçš„ç¯€é»æ¨™è¨˜
3. æŸ¥çœ‹ Console è¼¸å‡º

**éœ€è¦æª¢æŸ¥çš„è»Šç«™**:
```
1. ä¸Šé‡ç«™ (Ueno)        â†’ æ‡‰é¡¯ç¤º ğŸ‘‘
2. æ±äº¬ç«™ (Tokyo)       â†’ æ‡‰é¡¯ç¤º ğŸ‘‘
3. æ·ºè‰ç«™ (Asakusa)     â†’ æ‡‰é¡¯ç¤º ğŸ‘‘
4. ç§‹è‘‰åŸç«™ (Akihabara) â†’ æ‡‰é¡¯ç¤º ğŸ‘‘
5. éŠ€åº§ç«™ (Ginza)       â†’ æ‡‰é¡¯ç¤º ğŸ‘‘
```

**é æœŸè¦–è¦ºæ•ˆæœ**:
```
Hub ç¯€é»:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ‘‘    â”‚  â† çš‡å† åœ–ç¤º
â”‚  â”Œâ”€â”€â”€â”  â”‚
â”‚  â”‚ M â”‚  â”‚  â† ç‡Ÿé‹å•†å­—æ¯
â”‚  â””â”€â”€â”€â”˜  â”‚
â”‚   +5    â”‚  â† æˆå“¡æ•¸é‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Spoke ç¯€é»:
  â”Œâ”€â”€â”€â”
  â”‚ M â”‚     â† åªæœ‰å­—æ¯,ç„¡çš‡å† 
  â””â”€â”€â”€â”˜
```

**Console è¼¸å‡ºæª¢æŸ¥**:
```javascript
// é»æ“Š Hub ç¯€é»æ™‚æ‡‰è©²çœ‹åˆ°:
[NodeMarker] Hub detected: {
    id: "odpt:Station:TokyoMetro.Ginza.Ueno",
    isExplicitHub: true,  // âš ï¸ æ‡‰è©²ç‚º true
    hasMembers: true,
    memberCount: 5,
    parent_hub_id: null,  // âš ï¸ æ‡‰è©²ç‚º null
    is_hub: true
}
```

**åˆ¤æ–·æ¨™æº–**:
- âœ… **PASS**: æ‰€æœ‰ Hub ç¯€é»é¡¯ç¤ºçš‡å†  ğŸ‘‘
- âš ï¸ **éƒ¨åˆ†é€šé**: éƒ¨åˆ† Hub é¡¯ç¤ºçš‡å† ,éƒ¨åˆ†æœªé¡¯ç¤º
- âŒ **FAIL**: Hub ç¯€é»æœªé¡¯ç¤ºçš‡å† ,åªé¡¯ç¤º "M" å­—æ¯

**å¦‚æœå¤±æ•—**:
```javascript
// æª¢æŸ¥ Console è¼¸å‡º:
// 1. æ˜¯å¦æœ‰ [NodeMarker] Hub detected log?
// 2. isExplicitHub æ˜¯å¦ç‚º true?
// 3. parent_hub_id æ˜¯å¦ç‚º null?

// å¦‚æœæ²’æœ‰ log è¼¸å‡º,å¯èƒ½åŸå› :
// - hubDetails æœªè¢«æ­£ç¢ºå‚³é
// - ç¯€é»çš„ parent_hub_id ä¸æ˜¯ null
```

---

## ğŸ“Š æ¸¬è©¦çµæœè¨˜éŒ„è¡¨

è«‹æ ¹æ“šæ¸¬è©¦çµæœå¡«å¯«:

| æ¸¬è©¦é …ç›® | çµæœ | å‚™è¨» |
|---------|------|------|
| L2 Debug Logging | â˜ PASS<br>â˜ FAIL | `hasL2Status`: _____<br>`lineStatusCount`: _____ |
| L2 Fallback UI | â˜ PASS<br>â˜ FAIL | è¦–è¦ºæ•ˆæœ: _____ |
| Hub ç¯€é»åœ–ç¤º | â˜ PASS<br>â˜ FAIL | çš‡å† é¡¯ç¤ºæ•¸é‡: _____/5 |

---

## ğŸ” å•é¡Œè¨ºæ–·æµç¨‹

### å¦‚æœ L2 è³‡æ–™ä»æœªé¡¯ç¤º

#### Step 1: æª¢æŸ¥ Network Tab
```bash
1. Chrome DevTools â†’ Network Tab
2. é»æ“Šè»Šç«™ç¯€é»
3. æ‰¾åˆ° /api/nodes/[nodeId] è«‹æ±‚
4. æª¢æŸ¥ Response:
```

**é æœŸå›æ‡‰**:
```json
{
    "id": "odpt:Station:...",
    "name": {...},
    "l2_status": {           // âš ï¸ é€™å€‹å¿…é ˆå­˜åœ¨
        "line_status": [...], // âš ï¸ å¿…é ˆæœ‰è³‡æ–™
        "congestion": 2,
        "weather": {...}
    }
}
```

**å¦‚æœ `l2_status` ä¸å­˜åœ¨**:
```bash
# å•é¡Œåœ¨å¾Œç«¯ API
# éœ€è¦æª¢æŸ¥:
1. src/lib/api/nodes.ts (fetchNodeConfig å‡½æ•¸)
2. è³‡æ–™åº« transit_dynamic_snapshot è¡¨
3. ODPT API æ•´åˆ

# æª¢æŸ¥è³‡æ–™åº«:
psql -d lutagu_db -c "SELECT COUNT(*) FROM transit_dynamic_snapshot;"

# æ‡‰è©²è¿”å› > 0
```

#### Step 2: æª¢æŸ¥ Supabase Logs
```bash
# å¦‚æœä½¿ç”¨ Supabase
1. è¨ªå• Supabase Dashboard
2. Logs â†’ API Logs
3. æœå°‹ "nodes" ç›¸é—œè«‹æ±‚
4. æŸ¥çœ‹æ˜¯å¦æœ‰éŒ¯èª¤
```

### å¦‚æœ Hub åœ–ç¤ºä»ä¸æ­£ç¢º

#### Step 1: æª¢æŸ¥ç¯€é»è³‡æ–™
```bash
# åœ¨ Console åŸ·è¡Œ:
console.log(document.querySelector('[title="ä¸Šé‡"]'));

# æˆ–ç›´æ¥æª¢æŸ¥ Console çš„ Hub detected log
```

#### Step 2: æª¢æŸ¥ parent_hub_id
```sql
-- åœ¨è³‡æ–™åº«ä¸­æª¢æŸ¥:
SELECT id, parent_hub_id, is_hub
FROM nodes
WHERE name->>'zh-TW' LIKE '%ä¸Šé‡%';

-- ä¸Šé‡ç«™æ‡‰è©²:
-- parent_hub_id: null
-- is_hub: true
```

---

## ğŸ“¸ æ¸¬è©¦æˆªåœ–æŒ‡å—

è«‹æˆªåœ–ä»¥ä¸‹å…§å®¹:

### Screenshot 1: Console Logs
```
æˆªåœ–åŒ…å«:
- [NodeTabs] L2 Adapter log
- [L2_Live] Received data log
- [NodeMarker] Hub detected log
```

### Screenshot 2: L2 Fallback UI
```
æˆªåœ–åŒ…å«:
- å³å´é¢æ¿é¡¯ç¤º"ç‹€æ…‹" Tab
- Fallback UI å®Œæ•´å…§å®¹
```

### Screenshot 3: Hub ç¯€é»åœ°åœ–
```
æˆªåœ–åŒ…å«:
- åœ°åœ–å…¨æ™¯
- è‡³å°‘ 3 å€‹ Hub ç¯€é»å¯è¦‹
- å¯æ¸…æ¥šçœ‹åˆ°çš‡å† åœ–ç¤º
```

---

## âœ… æ¸¬è©¦å®Œæˆæª¢æŸ¥æ¸…å–®

æ¸¬è©¦å®Œæˆå¾Œ,è«‹ç¢ºèª:

- [ ] å·²å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
- [ ] å·²é–‹å•Ÿ Chrome DevTools
- [ ] å·²æ¸…ç©º Console
- [ ] å·²æ¸¬è©¦ L2 Debug Logging
- [ ] å·²æ¸¬è©¦ L2 Fallback UI
- [ ] å·²æ¸¬è©¦ Hub ç¯€é»åœ–ç¤º
- [ ] å·²å¡«å¯«æ¸¬è©¦çµæœè¨˜éŒ„è¡¨
- [ ] å·²æˆªåœ–é—œéµæ¸¬è©¦çµæœ

---

## ğŸ“ éœ€è¦å”åŠ©?

å¦‚æœæ¸¬è©¦éç¨‹ä¸­é‡åˆ°å•é¡Œ:

1. **Console æ²’æœ‰ä»»ä½• log è¼¸å‡º**
   - ç¢ºèªé–‹ç™¼ä¼ºæœå™¨æ­£åœ¨é‹è¡Œ
   - ç¢ºèª Console æ²’æœ‰è¢« filter
   - ç¢ºèªä¿®å¾©çš„ç¨‹å¼ç¢¼å·²è¢«è¼‰å…¥ (å¯èƒ½éœ€è¦ hard refresh: Ctrl+Shift+R)

2. **L2 è³‡æ–™å®Œå…¨ç„¡æ³•è¼‰å…¥**
   - æª¢æŸ¥ Network Tab çš„ API å›æ‡‰
   - æª¢æŸ¥è³‡æ–™åº«æ˜¯å¦æœ‰è³‡æ–™
   - åƒè€ƒ `FRONTEND_QUICK_FIX_GUIDE.md`

3. **Hub åœ–ç¤ºé‚è¼¯ä¸æ­£ç¢º**
   - æª¢æŸ¥ Console çš„ Hub detected log
   - ç¢ºèª parent_hub_id æ¬„ä½å€¼
   - æª¢æŸ¥ hubDetails æ˜¯å¦è¢«æ­£ç¢ºå‚³é

---

**æ¸¬è©¦æŒ‡å—å»ºç«‹è€…**: Claude AI Assistant
**æœ€å¾Œæ›´æ–°**: 2026-01-22 18:45 JST
**ç›¸é—œæ–‡ä»¶**:
- `FIX_SUMMARY.md` (ä¿®å¾©ç¸½çµ)
- `UX_TEST_REPORT.md` (UX æ¸¬è©¦å ±å‘Š)
- `FRONTEND_QUICK_FIX_GUIDE.md` (å¿«é€Ÿä¿®å¾©æŒ‡å—)
