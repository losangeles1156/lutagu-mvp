#MVP前置 #追蹤閉環 #Funnel #回應品質 #商業驗證 #TripGuard

# 20260114 工作日誌

## 今日結論（決策）
- 目前產品狀態定位為「MVP 前 Beta/Pilot」，不以功能完整為目標，而以「可驗證核心商業假設的最短閉環」為目標。
- MVP 的單一主流程收斂為：節點選擇 → AI 輸出 1 張主卡（最多 3 卡）→ 1 個可執行動作（路線/設施/外部連結）。
- 上線門檻（Definition of Done）以可觀測性為硬條件：能回答「來了沒、卡在哪、建議有沒有被採納」。

## 今日盤點（現況事實）

### 已落地的後台追蹤與品質模組
- 匿名訪客識別 cookie（bg_vid）已在 middleware 自動種植，後端可讀取。
- user_activities 表已建立，且 API 已接上客戶端事件（facility_open / external_link_click）。
- performance_metrics / ai_chat_metrics 表與彙總 view 已建立，Chat API 亦有實際寫入。
- ai_chat_feedback（thumbs up/down）表與 API 已建立，前端 Chat UI 也有送出。
- nudge_logs 與 partner 點擊欄位擴充已建立，具備基本 referral 追蹤基礎。

### 主要缺口（導致「像沒做」的地方）
- Funnel tracking 相關表與 API 已有，但前端沒有實際接到主流程，且 visitor/session 命名與 cookie 不一致，易導致漏斗資料斷裂。
- 回應品質沒有形成閉環：feedback 與 ai_chat_metrics 尚未關聯，後台難以用數據指導迭代（只能散點看 feedback）。
- Trip Guard 若作為 MVP 賣點，推播/通知仍未形成可驗證交付；短期需要降級策略以避免承諾落空。

## 風險與控管
- 若先做「更多功能」而非「可觀測閉環」，上線後將無法判斷問題是供給（內容/模型）或分發（UI/流程）導致，迭代成本大。
- 若 referral 行為無法穩定追蹤，MVP 將無法驗證變現假設。

## 後續開發階段任務（建議方案拆解）

### Phase 0：MVP 可觀測閉環（優先級 P0）
目標：把「用戶行為 → 漏斗 → 轉換」串成可用數據，支撐上線後迭代。

1) 統一匿名識別與會話標準
- 交付物：前後端統一使用 bg_vid 作為 visitor_id，統一 session_id 的生成與傳遞規則。
- 驗收：任一用戶從進站到外連點擊，能在同一個 visitor_id + session_id 下串起事件。

2) 啟用漏斗追蹤（Funnel）並接入主流程
- 交付物：在以下關鍵點發送 funnel_events：
  - query_input
  - ai_response_received
  - location_selected
  - facility_viewed
  - external_link_click
- 驗收：後台能查到完整漏斗轉換率，且 step_number 無跳號/大量缺失。

3) 建立「回應品質」最小閉環
- 交付物：feedback（thumbs up/down）能回填到對應的 ai_chat_metrics（以 request_id / session_id / message_id 任一可關聯方式）。
- 驗收：後台能看到滿意度（正負評比率）、低分原因分佈、低分樣本對應的工具鏈/延遲等指標。

4) 補上商業轉換最小追蹤
- 交付物：所有 referral 外連必須寫入 nudge_logs（或能映射到 nudge_log_id），點擊事件能回寫 clicked_at / conversion_status。
- 驗收：能算出每個 partner 的 suggestion→click 轉換率，且資料量足以做日/週趨勢。

### Phase 1：MVP 上線版功能收斂（優先級 P0/P1）
目標：縮到 1 條主流程與 1 個成功指標，避免「做不完」。

1) 定義 North Star Metric 與儀表板視角
- 交付物：NSM + 2~3 個 supporting metrics（例如：AI 回應時間、外連點擊率、漏斗完成率）。
- 驗收：後台能用同一套指標追蹤每次版本更新的改善/退化。

2) 落實「一個建議原則」的 UI/輸出約束
- 交付物：AI 輸出與 UI 卡片策略固定為 1 主卡 + 最多 2 副卡；互動行為集中到單一 CTA。
- 驗收：使用者在主流程中不需要做超過 1 次分岔選擇即可到達可執行動作。

3) Guest-first 的降級策略固化
- 交付物：在無登入狀態下，主流程仍能完成（至少：節點選擇→AI 建議→外連/設施）。
- 驗收：匿名訪客也能產生完整 funnel_events 與 user_activities。

### Phase 2：商業驗證與合作接口（優先級 P1）
目標：先可量測，再逐步接深連結與合作。

1) Referral 外連標準化
- 交付物：統一 partnerId/referralUrl 的生成規則，避免每個地方各自拼接。
- 驗收：任一外連點擊都能被歸因到 partnerId + 場景（nudge_type）。

2) 深連結整合（按合作成熟度逐步啟用）
- 交付物：GO / LUUP / Ecbo Cloak 的 deep link 以 feature flag 控制。
- 驗收：無合作時仍有可用替代（一般連結/教學引導），且追蹤不中斷。

### Phase 3：Trip Guard 交付路線（優先級 P2）
目標：避免承諾落空；先做可驗證，再做完整通知。

1) Trip Guard 降級版（可上線驗證）
- 交付物：訂閱保存 + 週期性狀態查詢（手動查看）；明確標示通知尚未啟用或為 Beta。
- 驗收：訂閱行為可追蹤（subscribe_attempt/success），且能看到留存與回訪。

2) 推播/通知正式版（合作與基礎設施齊備後）
- 交付物：LINE push（或替代通知）送達率可觀測、失敗重試策略、退訂流程。
- 驗收：延誤事件能在訂閱窗口內推送，並能在後台追蹤 delivered/clicked。

## 下次工作建議（最短路徑）
- 先完成 Phase 0（統一 visitor/session + funnel 接入 + feedback↔metrics 關聯），再做 Phase 1 的 UI 收斂。
