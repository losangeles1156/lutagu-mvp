# 2026 Product Gap Analysis
> Generated by Antigravity Agent | Date: 2026-01-24

## 1. Deep Research & Temporal Intelligence (AI Core)

### 1.1 Deep Research (Disconnected Brain)
- **Current State**: 
  - `vector-search-rs` service exists but is isolated.
  - `expert_knowledge` database table exists with 50+ rows.
  - `HybridEngine` relies solely on RegExp matching (`RegexDecisionEngine`), ignoring semantic meaning.
- **The Gap**: 
  - **No Semantic Search**: User questions like "Where can I find a quiet place in Asakusa?" fail because they don't match specific keywords like `lat/lon`.
  - **No Closed Loop**: System does not learn from failed queries. "Missed opportunities" are not recorded.
- **Risk**: High. The AI feels "dumb" compared to LLMs if it can't handle semantic nuance.

### 1.2 Temporal Intelligence (Time Blindness)
- **Current State**:
  - `timeUtils.ts` contains `JAPAN_HOLIDAYS_2026` and `getJSTTime()`.
  - `L4DecisionEngine` uses `currentDate` but **ignores** `isHoliday`.
  - `AlgorithmProvider` (L2) does not pass "Holiday/Weekday" context to the routing engine.
- **The Gap**:
  - **Sunday != Monday**: The system treats a Public Holiday exactly like a Tuesday work day for crowd prediction and routing.
  - **Rule Limitations**: `KnowledgeTrigger` cannot support rules like "Avoid Harajuku on Weekends" because the schema lacks `day_type` (weekday vs holiday).
- **Risk**: Medium. Routing recommendations will be inaccurate during Golden Week or weekends.

---

## 2. Frontend & User Experience

### 2.1 Missing "Research" UI
- **Current State**: 
  - Chat UI renders `Route` (Cards) and `Text`.
  - No specialized UI for "Deep Research" results (e.g., "AI Insight" blocks, Citation links).
- **The Gap**: 
  - When the AI retrieves expert knowledge (e.g., "Visit Senso-ji at 6 AM"), it appears as plain text. It lacks authority without visual distinction.

### 2.2 Map Visualization
- **Current State**: Map shows station nodes and lines.
- **The Gap**: 
  - No "Heatmap" or "Trend" visualization for `AlgorithmProvider`'s data. User sees a route but not *why* it was chosen (e.g., "Avoided Chuo Line due to delay").

---

## 3. Infrastructure & Feedback Loop

### 3.1 Unused Feedback Signal
- **Current State**: `demand_signals` table exists in schema but is empty/unused.
- **The Gap**: 
  - We have no mechanism to capture "User asked X, but we returned generic answer".
- **Remediation**: 
  - Implement `FeedbackLooper` service to analyze failed intent classifications and auto-generate "Wanted Knowledge" candidates.

---

## Summary of Recommendations
1. **Activate Vector Search**: Connect `HybridEngine` to `vector-search-rs` immediately.
2. **Patch Time Logic**: Inject `{ isHoliday: boolean }` into `L4DecisionEngine` context.
3. **Build Closed Loop**: Create a simple cron/service to populate `demand_signals` from chat logs.
