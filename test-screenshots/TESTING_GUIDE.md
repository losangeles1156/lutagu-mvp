# 地圖節點優化 - 手動測試指南

## 快速測試步驟

### 1. 啟動開發環境
```bash
npm run dev
# 開啟 http://localhost:3001
```

### 2. 測試流程

#### 步驟 1：進入地圖
1. 開啟瀏覽器前往 http://localhost:3001
2. 點擊「先逛逛」按鈕跳過引導

#### 步驟 2：測試 Zoom < 13（Mega Hubs Only）
1. 點擊地圖左下角的 **Zoom Out (-)** 按鈕 5-6 次
2. 地圖應顯示：
   - ✅ 僅顯示 4 線以上大型樞紐（上野、秋葉原等）
   - ✅ 樞紐站 marker 尺寸為 **64px**（視覺上很大）
   - ✅ 若有一般站顯示，尺寸應為 **28px**（視覺上較小）
   - ✅ 僅樞紐站顯示標籤（車站名稱）

**預期畫面**：地圖清爽，只有幾個大型樞紐突出顯示

#### 步驟 3：測試 Zoom 13-14（Major Hubs）
1. 點擊 **Zoom In (+)** 按鈕 2-3 次
2. 地圖應顯示：
   - ✅ 增加 2 線以上轉乘站
   - ✅ 樞紐站仍保持 **64px** 大尺寸
   - ✅ 一般站仍為 **28px**
   - ✅ 主要站開始顯示標籤（Zoom 14+）

**預期畫面**：更多站點出現，但樞紐站仍明顯突出

#### 步驟 4：測試 Zoom ≥ 15（All Stations）
1. 繼續點擊 **Zoom In (+)** 直到 Zoom 15 或以上
2. 地圖應顯示：
   - ✅ 所有車站（包含單線站）
   - ✅ 樞紐站尺寸變為 **56px**
   - ✅ 一般站尺寸變為 **48px**
   - ✅ Zoom 16+ 時所有站都顯示標籤

**預期畫面**：完整站點資訊，樞紐站與一般站尺寸接近但仍有區別

#### 步驟 5：節點互動測試
1. 點擊任一樞紐站（如「上野」）
2. 檢查：
   - ✅ 選中的站點應加上外框高亮
   - ✅ 底部應彈出資訊面板
   - ✅ 顯示轉乘資訊（+2, +3 等 badge）

---

## 詳細檢查清單

### 視覺階層檢查

| Zoom 級別 | 樞紐站尺寸 | 一般站尺寸 | 標籤顯示 | 預期效果 |
|-----------|-----------|-----------|---------|---------|
| 11-12 | 64px | 28px | 僅樞紐 | 極高對比 |
| 13-14 | 64px | 28px | 樞紐+部分主要站 | 高對比 |
| 15+ | 56px | 48px | 全部 | 適中對比 |

### 功能檢查

- [ ] 縮放流暢，無卡頓
- [ ] 節點切換無延遲
- [ ] 標籤無重疊遮擋
- [ ] 樞紐站於低 Zoom 時極為突出
- [ ] Crown 圖示正常顯示（機場、主要站）
- [ ] 轉乘 badge 正確顯示（+2, +3 等）
- [ ] 選中節點有視覺回饋
- [ ] 底部面板正確顯示資訊

### 效能檢查

- [ ] 快速縮放地圖（連續點擊 +/-）時無明顯延遲
- [ ] 在東京站、新宿站等密集區域拖曳流暢
- [ ] 瀏覽器 Console 無錯誤訊息
- [ ] 記憶體使用正常（可在 DevTools Performance 查看）

---

## 問題排查

### 如果樞紐站不夠突出
檢查：
- 瀏覽器快取是否已清除（Cmd+Shift+R）
- 開發伺服器是否已重啟
- 檢查 Console 是否有 JavaScript 錯誤

### 如果一般站沒有縮小
檢查：
- Zoom 級別是否確實 < 14（可在 Console 輸入 `window.mapZoom` 查看）
- 節點的 `is_hub` / `parent_hub_id` 欄位是否正確

### 如果標籤顯示異常
檢查：
- 節點的 `hubDetails.member_count` 是否正確
- `isMajor` 邏輯是否正確判斷

---

## 截圖記錄建議

為了便於比對，建議在以下 Zoom 級別截圖：

1. **Zoom 11**：test-screenshots/zoom-11-mega-hubs.png
2. **Zoom 13**：test-screenshots/zoom-13-major-hubs.png
3. **Zoom 15**：test-screenshots/zoom-15-all-stations.png
4. **Zoom 17**：test-screenshots/zoom-17-full-detail.png

可使用瀏覽器內建截圖功能或 DevTools 的 Screenshot 功能。

---

## 預期結果總結

### 成功標準
✅ 樞紐站在低 Zoom 時明顯大於一般站（2.29x 對比）
✅ 標籤按優先級漸進顯示，不造成視覺雜亂
✅ 分級顯示邏輯正確（4+ → 2+ → 所有）
✅ 地圖操作流暢，無效能問題

### 若測試通過
恭喜！優化已成功實作，可以進入下一階段開發。

### 若測試失敗
請記錄問題細節並參考 `test-zoom-logic.md` 中的程式碼位置進行除錯。

---

**測試文件版本**：v1.0
**最後更新**：2026-01-23
