# Transfer Judgment Knowledge (轉乘判斷)

本文件定義 L4 轉乘建議的核心邏輯。
目標是回答：「怎麼搭最輕鬆？」與「我該在哪個車廂下車？」

## 1. TPI 轉乘痛苦評估 (Transfer Pain Index)

**應用場景**: 當有多條路線可選時，依據用戶狀態（行李、嬰兒車）推薦最不痛苦的路徑，而非單純最短時間。

### 評估維度
| 維度 | 說明 | 權重 (高/中/低) |
| :--- | :--- | :--- |
| **垂直移動** | 階梯 vs 電扶梯 vs 電梯。 | 高 (對攜帶行李者為 Critical) |
| **水平距離** | 轉乘通道長度 (例如東京站京葉線轉乘約 500m)。 | 中 |
| **人潮密度** | 該時段/路線的擁擠程度 (新宿 vs 代代木)。 | 中 |
| **動線複雜度** | 是否需要出站再進站 (橘色改札口)。 | 低 |

### 判斷邏輯 (Pseudo-Code)
```typescript
function calculateTPI(route: Route, userState: UserState): number {
  let painScore = 0;
  if (userState.hasLuggage && route.hasStairsOnly) painScore += 50;
  painScore += route.walkingDistance / 10; // 每 10m +1 分
  return painScore;
}
```

---

## 2. 月台相對位置 (Platform & Car Positioning)

**應用場景**: 「搭哪節車廂比較好？」
**核心數據**: 每個車站/路線的「最佳車廂表」。

*   **最近出口**: 離主要改札口最近的車廂。
*   **轉乘最短**: 離轉乘通道/樓梯最近的車廂。
*   **電梯專用**: 離電梯最近的車廂 (對應 TPI 高優先級)。
*   **空車率高**: 通常頭尾車廂較空 (例外：轉乘站靠近頭尾時)。

---

## 3. 出口選擇邏輯 (Exit Selection)

**應用場景**: 「我該走哪個出口？」
**防呆機制**: 東京車站有 20+ 出口，必須精準指引。

*   **地面 POI 綁定**: 每個 L1 POI 需標記 `nearest_exit_id`。
*   **樓層資訊**: 標註出口位於 B1, 1F, 或 2F (如澀谷站複雜地形)。
*   **設施對應**: 該出口是否有手扶梯/電梯。

---

## 4. 直通運轉判斷 (Through-Service Logic)

**應用場景**: 「這班車會直達嗎？需要下車嗎？」
**常見誤區**:
*   **半藏門線 -> 東急田園都市線**: 直通，不需下車。
*   **東西線 -> JR 中央總武線**: 直通，但僅限特定班次。
*   **日比谷線 -> 東武晴空塔線**: 直通。

**AI 提示語**:
> 「這班車雖然名字換了，但不需要下車喔！它會直接變成 [路線B] 繼續開。」
