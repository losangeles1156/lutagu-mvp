# LUTAGU æ•¸æ“šç­–ç•¥
# éœæ…‹æ•¸æ“šåŸå‰‡èˆ‡åŒå¿ƒåœ“æœå‹™æ¶æ§‹

---

## ğŸ¯ æœ¬æ–‡ä»¶çš„ä½¿ç”¨æ–¹å¼

```
çµ¦ AI é–‹ç™¼ä»£ç†çš„æŒ‡å¼•ï¼š

æœ€é‡è¦çš„ä¸€æ¢è¦å‰‡ï¼š
L1 æ¨™ç±¤æ˜¯ã€Œå†·æ•¸æ“šã€ï¼ŒApp åŸ·è¡Œæ™‚åªè®€å–ã€ä¸è¨ˆç®—ï¼

å¦‚æœä½ å¯«äº†ä¸€æ®µç¨‹å¼ç¢¼ï¼Œè©¦åœ–åœ¨ç”¨æˆ¶æ‰“é–‹ App æ™‚
å³æ™‚å‘¼å« Overpass API è¨ˆç®—ã€Œé™„è¿‘æœ‰å¹¾å®¶é¤å»³ã€ï¼Œ
é‚£å°±æ˜¯éŒ¯èª¤çš„è¨­è¨ˆã€‚

æ­£ç¢ºåšæ³•ï¼š
- n8n æ‰¹æ¬¡è¨ˆç®— â†’ å¯«å…¥ DB
- App è®€å– DB â†’ ç›´æ¥é¡¯ç¤º
```

---

## 1. éœæ…‹æ•¸æ“šåŸå‰‡ï¼ˆData Origin Constraintï¼‰

### 1.1 æ ¸å¿ƒæ¦‚å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•¸æ“šæº«åº¦åˆ†é¡                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ğŸ§Š å†·æ•¸æ“š (Cold Data)                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚   â€¢ L1 åœ°é»åŸºå› ï¼ˆé¡åˆ¥çµ±è¨ˆã€Vibe Tagsï¼‰                           â”‚
â”‚   â€¢ ç¯€é»åŸºæœ¬è³‡æ–™ï¼ˆåç¨±ã€åº§æ¨™ã€æ‰€å±¬ Hubï¼‰                          â”‚
â”‚   â€¢ AI äººæ ¼ Prompt                                              â”‚
â”‚   â€¢ å•†æ¥­å°æµè¦å‰‡                                                 â”‚
â”‚                                                                 â”‚
â”‚   æ›´æ–°é »ç‡ï¼šæ¯å­£ / æœ‰é‡å¤§è®ŠåŒ–æ™‚                                   â”‚
â”‚   ç”Ÿæˆæ–¹å¼ï¼šn8n æ‰¹æ¬¡ ETL                                         â”‚
â”‚   å„²å­˜ä½ç½®ï¼šSupabase PostgreSQL                                  â”‚
â”‚   App è¡Œç‚ºï¼šåªè®€å–ï¼Œä¸è¨ˆç®—                                       â”‚
â”‚                                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                 â”‚
â”‚   ğŸŒ¡ï¸ æº«æ•¸æ“š (Warm Data)                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚   â€¢ L3 è¨­æ–½è³‡æ–™ï¼ˆå»æ‰€ã€ç½®ç‰©æ«ƒä½ç½®ï¼‰                               â”‚
â”‚   â€¢ L3 å­é¡åˆ¥æ™¯é»ï¼ˆåº—å®¶ã€æ™¯é»è©³æƒ…ï¼‰                               â”‚
â”‚   â€¢ ç‡Ÿæ¥­æ™‚é–“ã€è¯çµ¡è³‡è¨Š                                           â”‚
â”‚                                                                 â”‚
â”‚   æ›´æ–°é »ç‡ï¼šæ¯æœˆ / æœ‰è®Šå‹•æ™‚                                       â”‚
â”‚   ç”Ÿæˆæ–¹å¼ï¼šn8n å®šæœŸ + æ‰‹å‹•ç¶­è­·                                  â”‚
â”‚   å„²å­˜ä½ç½®ï¼šSupabase PostgreSQL                                  â”‚
â”‚   App è¡Œç‚ºï¼šæŸ¥è©¢ DBï¼Œå¯å¿«å–                                      â”‚
â”‚                                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                 â”‚
â”‚   ğŸ”¥ ç†±æ•¸æ“š (Hot Data)                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚   â€¢ L2 å³æ™‚ç‹€æ…‹ï¼ˆäº¤é€šå»¶èª¤ã€äººæ½®æ“æ“ ï¼‰                             â”‚
â”‚   â€¢ å¤©æ°£è³‡è¨Š                                                     â”‚
â”‚   â€¢ ç‰¹æ®Šäº‹ä»¶                                                     â”‚
â”‚                                                                 â”‚
â”‚   æ›´æ–°é »ç‡ï¼š15-20 åˆ†é˜                                           â”‚
â”‚   ç”Ÿæˆæ–¹å¼ï¼šn8n å®šæ™‚ Webhook                                     â”‚
â”‚   å„²å­˜ä½ç½®ï¼šRedisï¼ˆTTL 20 åˆ†é˜ï¼‰                                 â”‚
â”‚   App è¡Œç‚ºï¼šå³æ™‚æŸ¥è©¢                                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç‚ºä»€éº¼é€™å¾ˆé‡è¦ï¼Ÿ

```
éŒ¯èª¤è¨­è¨ˆçš„å¾Œæœï¼š

ç”¨æˆ¶æ‰“é–‹ App
    â†“
App å‘¼å« Overpass API
    â†“
è¨ˆç®—å‘¨é‚Š 200m æœ‰å¤šå°‘é¤å»³ã€å•†åº—...
    â†“
ç­‰å¾… 2-3 ç§’
    â†“
ç”¨æˆ¶ä¸è€ç…©ï¼Œè·³å‡º App
    â†“
DAU ä¸‹é™ï¼Œå°ˆæ¡ˆå¤±æ•—

æ­£ç¢ºè¨­è¨ˆçš„æ•ˆæœï¼š

ç”¨æˆ¶æ‰“é–‹ App
    â†“
App è®€å– DBï¼ˆå·²é å…ˆè¨ˆç®—å¥½çš„æ•¸æ“šï¼‰
    â†“
< 100ms é¡¯ç¤ºçµæœ
    â†“
ç”¨æˆ¶æ»¿æ„ï¼Œç¹¼çºŒä½¿ç”¨
    â†“
DAU æˆé•·ï¼Œå°ˆæ¡ˆæˆåŠŸ
```

### 1.3 æ­£ç¢ºæ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é–‹ç™¼/ç¶­è­·éšæ®µ                              â”‚
â”‚                    ï¼ˆèƒŒæ™¯åŸ·è¡Œï¼Œç”¨æˆ¶ç„¡æ„Ÿï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚   n8n       â”‚    â”‚  Overpass   â”‚    â”‚  ç¿»è­¯ API   â”‚        â”‚
â”‚   â”‚  Workflow   â”‚â”€â”€â”€â–¶â”‚    API      â”‚â”€â”€â”€â–¶â”‚  (DeepL)    â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚          â”‚                                      â”‚               â”‚
â”‚          â”‚         è¨ˆç®— L1 æ¨™ç±¤                 â”‚ å¤šèªç³»è½‰è­¯    â”‚
â”‚          â”‚                                      â”‚               â”‚
â”‚          â–¼                                      â–¼               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚                   Supabase                       â”‚          â”‚
â”‚   â”‚            nodes.facility_profile                â”‚          â”‚
â”‚   â”‚            nodes.vibe_tags                       â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚   è§¸ç™¼æ¢ä»¶ï¼š                                                     â”‚
â”‚   â€¢ æ¯å­£å®šæ™‚åŸ·è¡Œ                                                 â”‚
â”‚   â€¢ æ–°å¢/ä¿®æ”¹ç¯€é»æ™‚æ‰‹å‹•è§¸ç™¼                                       â”‚
â”‚   â€¢ å‘¨é‚Šæœ‰é‡å¤§é–‹ç™¼æ™‚æ‰‹å‹•è§¸ç™¼                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ æ•¸æ“šå·²å­˜åœ¨ DB ä¸­
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        App åŸ·è¡Œéšæ®µ                               â”‚
â”‚                      ï¼ˆç”¨æˆ¶å¯¦éš›ä½¿ç”¨ï¼‰                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚   ç”¨æˆ¶      â”‚    â”‚   App       â”‚    â”‚  Supabase   â”‚        â”‚
â”‚   â”‚  æ‰“é–‹ App   â”‚â”€â”€â”€â–¶â”‚  è®€å– DB    â”‚â”€â”€â”€â–¶â”‚  å›å‚³æ•¸æ“š   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â”‚ < 100ms                          â”‚
â”‚                              â–¼                                  â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                       â”‚  ç›´æ¥é¡¯ç¤º   â”‚                           â”‚
â”‚                       â”‚  ä¸è¨ˆç®—ï¼   â”‚                           â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ETL æµç¨‹è©³è§£

### 2.1 L1 æ¨™ç±¤ç”Ÿæˆæµç¨‹

```
Step 1: å®šç¾©ç¯€é»æ¸…å–®
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  nodes è¡¨                            â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚  id: 'ueno_station'                 â”‚
        â”‚  coordinates: (139.777, 35.713)     â”‚
        â”‚  facility_profile: null  â† å¾…å¡«å……   â”‚
        â”‚  vibe_tags: null         â† å¾…å¡«å……   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: n8n Workflow åŸ·è¡Œ
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Overpass Query                      â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚  [out:json];                         â”‚
        â”‚  (                                   â”‚
        â”‚    node["shop"](around:200,          â”‚
        â”‚         35.713,139.777);             â”‚
        â”‚    node["amenity"](around:200,       â”‚
        â”‚         35.713,139.777);             â”‚
        â”‚    ...                               â”‚
        â”‚  );                                  â”‚
        â”‚  out count;                          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: è¨ˆç®—é¡åˆ¥çµ±è¨ˆ
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Raw Data â†’ Category Counts          â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚  {                                   â”‚
        â”‚    shopping: 23,                     â”‚
        â”‚    dining: 18,                       â”‚
        â”‚    leisure: 8,                       â”‚
        â”‚    medical: 5                        â”‚
        â”‚  }                                   â”‚
        â”‚                                      â”‚
        â”‚  éæ¿¾è¦å‰‡ï¼šcount > 0 æ‰ä¿ç•™          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4: ç”Ÿæˆ Vibe Tags
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Category Counts â†’ Vibe Tags         â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚  shopping: 23 (æœ€é«˜)                 â”‚
        â”‚  â†’ #è³¼ç‰©å¤©å ‚                         â”‚
        â”‚                                      â”‚
        â”‚  dining: 18 (æ¬¡é«˜)                   â”‚
        â”‚  â†’ #ç¾é£Ÿæ¿€æˆ°å€                       â”‚
        â”‚                                      â”‚
        â”‚  leisure: 8 (æœ‰æ–‡åŒ–è¨­æ–½)             â”‚
        â”‚  â†’ #æ–‡åŒ–èšè½                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 5: å¤šèªç³»è½‰è­¯
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Vibe Tags ç¿»è­¯                      â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚  {                                   â”‚
        â”‚    "zh-TW": ["è³¼ç‰©å¤©å ‚", "ç¾é£Ÿæ¿€æˆ°å€"],â”‚
        â”‚    "ja": ["è²·ã„ç‰©å¤©å›½", "ã‚°ãƒ«ãƒ¡æ¿€æˆ¦åŒº"],â”‚
        â”‚    "en": ["Shopping Paradise",       â”‚
        â”‚           "Foodie Haven"]            â”‚
        â”‚  }                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 6: å¯«å…¥è³‡æ–™åº«
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  UPDATE nodes                        â”‚
        â”‚  SET                                 â”‚
        â”‚    facility_profile = {...},         â”‚
        â”‚    vibe_tags = {...},                â”‚
        â”‚    l1_calculated_at = NOW()          â”‚
        â”‚  WHERE id = 'ueno_station';          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 L3 è¨­æ–½/æ™¯é»ç”Ÿæˆæµç¨‹

```
Step 1: æŸ¥è©¢ OSM è¨­æ–½
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Overpass Query (è©³ç´°è³‡æ–™)           â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚  [out:json];                         â”‚
        â”‚  (                                   â”‚
        â”‚    node["amenity"="toilets"]         â”‚
        â”‚       (around:200,35.713,139.777);   â”‚
        â”‚  );                                  â”‚
        â”‚  out body;                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: è§£æåŸå§‹æ•¸æ“š
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Raw OSM Data                        â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚  {                                   â”‚
        â”‚    "name": "åŒ—å£ãƒˆã‚¤ãƒ¬",              â”‚
        â”‚    "wheelchair": "yes",              â”‚
        â”‚    "opening_hours": "24/7",          â”‚
        â”‚    "lat": 35.714,                    â”‚
        â”‚    "lon": 139.778                    â”‚
        â”‚  }                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: è½‰è­¯èˆ‡æ¨™æº–åŒ–
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Standardized Facility               â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚  {                                   â”‚
        â”‚    "id": "facility:ueno:toilet:001", â”‚
        â”‚    "node_id": "ueno_station",        â”‚
        â”‚    "type": "toilet",                 â”‚
        â”‚    "name": {                         â”‚
        â”‚      "zh-TW": "åŒ—å£å»æ‰€",            â”‚
        â”‚      "ja": "åŒ—å£ãƒˆã‚¤ãƒ¬",             â”‚
        â”‚      "en": "North Exit Toilet"       â”‚
        â”‚    },                                â”‚
        â”‚    "direction": {                    â”‚
        â”‚      "zh-TW": "åŒ—å£å‡ºä¾†å³è½‰",        â”‚
        â”‚      "ja": "åŒ—å£ã‚’å‡ºã¦å³",           â”‚
        â”‚      "en": "Exit north, turn right"  â”‚
        â”‚    },                                â”‚
        â”‚    "attributes": {                   â”‚
        â”‚      "accessible": true,             â”‚
        â”‚      "opening_hours": "24/7"         â”‚
        â”‚    },                                â”‚
        â”‚    "google_maps_url": "https://..."  â”‚
        â”‚  }                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4: å¯«å…¥è³‡æ–™åº«
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  INSERT INTO facilities              â”‚
        â”‚  VALUES (...);                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 L2 å³æ™‚ç‹€æ…‹æ›´æ–°æµç¨‹

```
è§¸ç™¼æ–¹å¼ï¼šn8n Cron Jobï¼Œæ¯ 15 åˆ†é˜åŸ·è¡Œ

Step 1: å‘¼å« ODPT API
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  GET /odpt:TrainInformation          â”‚
        â”‚  Authorization: Bearer {API_KEY}     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: è§£æå»¶èª¤è³‡è¨Š
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  {                                   â”‚
        â”‚    "odpt:railway": "TokyoMetro.Ginza",â”‚
        â”‚    "odpt:trainInformationStatus": {  â”‚
        â”‚      "ja": "é…å»¶"                    â”‚
        â”‚    },                                â”‚
        â”‚    "odpt:trainInformationText": {    â”‚
        â”‚      "ja": "ç´„15åˆ†é…ã‚Œ"              â”‚
        â”‚    }                                 â”‚
        â”‚  }                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: è½‰æ›ç‚ºæ¨™æº–æ ¼å¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  L2_LiveStatus                       â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚  {                                   â”‚
        â”‚    "node_id": "ueno_station",        â”‚
        â”‚    "transit_status": [{              â”‚
        â”‚      "line_id": "TokyoMetro.Ginza",  â”‚
        â”‚      "line_name": {                  â”‚
        â”‚        "zh-TW": "éŠ€åº§ç·š",            â”‚
        â”‚        "ja": "éŠ€åº§ç·š",               â”‚
        â”‚        "en": "Ginza Line"            â”‚
        â”‚      },                              â”‚
        â”‚      "status": "minor_delay",        â”‚
        â”‚      "delay_minutes": 15             â”‚
        â”‚    }],                               â”‚
        â”‚    "updated_at": "2025-12-22T10:00"  â”‚
        â”‚  }                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4: å¯«å…¥ Redis
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  SET l2:ueno_station {json}          â”‚
        â”‚  EXPIRE l2:ueno_station 1200         â”‚
        â”‚  (TTL = 20 åˆ†é˜)                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. åŒå¿ƒåœ“æ•¸æ“šç­–ç•¥

### 3.1 åœˆå±¤å®šç¾©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åŒå¿ƒåœ“æœå‹™æ¶æ§‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                         â”‚   Core    â”‚                           â”‚
â”‚                         â”‚  æ ¸å¿ƒåœˆ   â”‚                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”                      â”‚
â”‚                    â”‚       Buffer        â”‚                      â”‚
â”‚                    â”‚       ç·©è¡åœˆ        â”‚                      â”‚
â”‚               â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”                  â”‚
â”‚               â”‚            Outer              â”‚                  â”‚
â”‚               â”‚            å¤–éƒ¨åœˆ             â”‚                  â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                 â”‚
â”‚   Coreï¼ˆæ ¸å¿ƒåœˆï¼‰                                                 â”‚
â”‚   â€¢ å®Œæ•´ L1-L4 æœå‹™                                             â”‚
â”‚   â€¢ Hub + Spoke ç¯€é»                                            â”‚
â”‚   â€¢ å•†æ¥­å°æµåŠŸèƒ½                                                 â”‚
â”‚   â€¢ AI äººæ ¼å°è©±                                                  â”‚
â”‚   â€¢ ç¯„åœï¼šå°æ±å€ã€åƒä»£ç”°å€ã€ä¸­å¤®å€                               â”‚
â”‚                                                                 â”‚
â”‚   Bufferï¼ˆç·©è¡åœˆï¼‰                                               â”‚
â”‚   â€¢ åŸºæœ¬è·¯ç·šæŸ¥è©¢                                                 â”‚
â”‚   â€¢ L2 äº¤é€šç‹€æ…‹                                                  â”‚
â”‚   â€¢ ç„¡ L1 æ¨™ç±¤                                                   â”‚
â”‚   â€¢ èª å¯¦èªªã€Œé€™è£¡æˆ‘ä¸å¤ªç†Ÿã€                                       â”‚
â”‚   â€¢ ç¯„åœï¼šæ ¸å¿ƒåœˆå‘¨é‚Š 5km                                         â”‚
â”‚                                                                 â”‚
â”‚   Outerï¼ˆå¤–éƒ¨åœˆï¼‰                                                â”‚
â”‚   â€¢ åªæä¾›ã€Œå‰å¾€æ ¸å¿ƒåœˆã€çš„è·¯ç·š                                    â”‚
â”‚   â€¢ å„ªé›…å¼•å°è‡³ Google Maps                                       â”‚
â”‚   â€¢ ç¯„åœï¼šç·©è¡åœˆä»¥å¤–                                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åœˆå±¤åˆ¤å®šé‚è¼¯

```typescript
// lib/zone/detector.ts

interface ZoneBounds {
  core: GeoJSON.Polygon;
  buffer: GeoJSON.Polygon;
}

// Tokyo MVP åœˆå±¤å®šç¾©
const TOKYO_ZONES: ZoneBounds = {
  core: {
    type: 'Polygon',
    coordinates: [[
      [139.73, 35.65],  // è¥¿å—è§’
      [139.82, 35.65],  // æ±å—è§’
      [139.82, 35.74],  // æ±åŒ—è§’
      [139.73, 35.74],  // è¥¿åŒ—è§’
      [139.73, 35.65],  // é–‰åˆ
    ]],
  },
  buffer: {
    type: 'Polygon',
    coordinates: [[
      [139.68, 35.60],
      [139.87, 35.60],
      [139.87, 35.79],
      [139.68, 35.79],
      [139.68, 35.60],
    ]],
  },
};

export function detectZone(
  coordinates: { lat: number; lng: number }
): 'core' | 'buffer' | 'outer' {
  const point = turf.point([coordinates.lng, coordinates.lat]);
  
  if (turf.booleanPointInPolygon(point, TOKYO_ZONES.core)) {
    return 'core';
  }
  
  if (turf.booleanPointInPolygon(point, TOKYO_ZONES.buffer)) {
    return 'buffer';
  }
  
  return 'outer';
}
```

### 3.3 å„åœˆå±¤æœå‹™å·®ç•°

| åŠŸèƒ½ | Core | Buffer | Outer |
|------|------|--------|-------|
| L1 åœ°é»åŸºå›  | âœ… å®Œæ•´ | âŒ ç„¡ | âŒ ç„¡ |
| L2 å³æ™‚ç‹€æ…‹ | âœ… å®Œæ•´ | âœ… åŸºæœ¬ï¼ˆè·¯ç·šç‹€æ…‹ï¼‰ | âŒ ç„¡ |
| L3 è¨­æ–½æœå°‹ | âœ… å®Œæ•´ | âŒ ç„¡ | âŒ ç„¡ |
| L4 AI å»ºè­° | âœ… å®Œæ•´ | âš ï¸ åŸºæœ¬è·¯ç·š | âŒ å¼•å°è‡³ Google Maps |
| å•†æ¥­å°æµ | âœ… å®Œæ•´ | âŒ ç„¡ | âŒ ç„¡ |
| AI äººæ ¼å°è©± | âœ… å®Œæ•´ | âŒ ç„¡ | âŒ ç„¡ |

### 3.4 åœˆå±¤å›æ‡‰ç¯„ä¾‹

```typescript
// Core åœˆå±¤å›æ‡‰
{
  zone: 'core',
  response: 'å¾ä¸Šé‡ç«™åˆ°æ·ºè‰ï¼Œå»ºè­°æ­éŠ€åº§ç·šï¼Œ5 åˆ†é˜ç›´é”ï¼ç›®å‰ä¸æ“æ“ ï¼Œå¾ˆé©åˆç¾åœ¨å‡ºç™¼ã€‚',
  actionCards: [
    { type: 'transit', title: 'ğŸšƒ éŠ€åº§ç·š', duration: 5, price: 'Â¥170' },
    { type: 'taxi', title: 'ğŸš• GO Taxi', duration: 8, price: 'Â¥1,200' },
  ],
  facilities: [...],  // å®Œæ•´è¨­æ–½è³‡è¨Š
}

// Buffer åœˆå±¤å›æ‡‰
{
  zone: 'buffer',
  response: 'é€™è£¡æˆ‘ä¸å¤ªç†Ÿæ‚‰ ğŸ˜… ä¸éæˆ‘å¯ä»¥å‘Šè¨´ä½ æ€éº¼å‰å¾€ä¸Šé‡æˆ–æ·ºè‰ï¼Œé‚£é‚Šæˆ‘å¾ˆç†Ÿï¼',
  actionCards: [
    { type: 'transit', title: 'ğŸšƒ å‰å¾€ä¸Šé‡', duration: 15 },
  ],
  disclaimer: 'åƒ…æä¾›åŸºæœ¬è·¯ç·šè³‡è¨Š',
}

// Outer åœˆå±¤å›æ‡‰
{
  zone: 'outer',
  response: 'é€™å€‹ä½ç½®è¶…å‡ºæˆ‘çš„æœå‹™ç¯„åœäº† ğŸ¦Œ å»ºè­°ä½¿ç”¨ Google Maps æŸ¥è©¢ï¼Œæˆ–è€…æˆ‘å¯ä»¥å¹«ä½ è¦åŠƒå‰å¾€æ±äº¬éƒ½å¿ƒçš„è·¯ç·šï¼',
  actionCards: [
    { type: 'external', title: 'ğŸ“ é–‹å•Ÿ Google Maps', deeplink: 'https://maps.google.com/...' },
    { type: 'transit', title: 'ğŸšƒ å‰å¾€æ±äº¬éƒ½å¿ƒ' },
  ],
}
```

---

## 4. æ›´æ–°é »ç‡è¦ç¯„

### 4.1 é »ç‡ç¸½è¡¨

| æ•¸æ“šé¡å‹ | æº«åº¦ | æ›´æ–°é »ç‡ | è§¸ç™¼æ–¹å¼ | åŸ·è¡Œæ™‚é–“ |
|----------|------|----------|----------|----------|
| L1 æ¨™ç±¤ | ğŸ§Š å†· | æ¯å­£ | æ‰‹å‹• / æ’ç¨‹ | é›¢å³°æ™‚æ®µ |
| AI äººæ ¼ | ğŸ§Š å†· | è¦–éœ€è¦ | æ‰‹å‹• | éš¨æ™‚ |
| å•†æ¥­è¦å‰‡ | ğŸ§Š å†· | è¦–éœ€è¦ | æ‰‹å‹• | éš¨æ™‚ |
| L3 è¨­æ–½ | ğŸŒ¡ï¸ æº« | æ¯æœˆ | æ’ç¨‹ | é›¢å³°æ™‚æ®µ |
| L3 æ™¯é» | ğŸŒ¡ï¸ æº« | æ¯æœˆ | æ’ç¨‹ | é›¢å³°æ™‚æ®µ |
| L2 äº¤é€š | ğŸ”¥ ç†± | 15 åˆ†é˜ | Cron | å…¨å¤© |
| L2 å¤©æ°£ | ğŸ”¥ ç†± | 30 åˆ†é˜ | Cron | å…¨å¤© |

### 4.2 å·®ç•°åŒ–æ›´æ–°ç­–ç•¥

```
æ ¸å¿ƒåŸå‰‡ï¼šåªæ›´æ–°æœ‰è®ŠåŒ–çš„æ•¸æ“š

L2 æ›´æ–°ç¯„ä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  n8n Workflow: Update L2 Status                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  Step 1: å–å¾— ODPT æœ€æ–°æ•¸æ“š                                     â”‚
â”‚  Step 2: æ¯”å° Redis ç¾æœ‰æ•¸æ“š                                    â”‚
â”‚  Step 3: åªæ›´æ–°æœ‰è®ŠåŒ–çš„æ¬„ä½                                      â”‚
â”‚  Step 4: è¨˜éŒ„ updated_at                                        â”‚
â”‚                                                                 â”‚
â”‚  // è™›æ“¬ç¢¼                                                       â”‚
â”‚  for each line in odpt_response:                                â”‚
â”‚    current = redis.get(line.id)                                 â”‚
â”‚    if current.status != line.status:                            â”‚
â”‚      redis.set(line.id, line)                                   â”‚
â”‚      log('Updated: ' + line.id)                                 â”‚
â”‚    else:                                                        â”‚
â”‚      log('No change: ' + line.id)                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. å¤šèªç³»è½‰è­¯è¦ç¯„

### 5.1 è½‰è­¯æ™‚æ©Ÿ

```
é—œéµåŸå‰‡ï¼šå„²å­˜å‰å®Œæˆè½‰è­¯ï¼ŒApp ä¸åšç¿»è­¯ï¼

ETL æµç¨‹ä¸­çš„è½‰è­¯ï¼š
1. å¾ API å–å¾—åŸå§‹æ•¸æ“šï¼ˆé€šå¸¸æ˜¯æ—¥æ–‡ï¼‰
2. å‘¼å«ç¿»è­¯ APIï¼ˆDeepL / Google Translateï¼‰
3. æ•´ç†æˆå¤šèªç³» JSON
4. å¯«å…¥è³‡æ–™åº«

App åŸ·è¡Œæ™‚ï¼š
- æ ¹æ“šç”¨æˆ¶èªç³»ï¼Œç›´æ¥è®€å–å°æ‡‰æ¬„ä½
- ä¸å‘¼å«ç¿»è­¯ API
- ä¸åšä»»ä½•è½‰æ›
```

### 5.2 å°ˆæœ‰åè©å°ç…§è¡¨

```typescript
// é å®šç¾©çš„å°ˆæœ‰åè©å°ç…§ï¼ˆä¸é€éç¿»è­¯ APIï¼‰
const PROPER_NOUNS: Record<string, LocalizedText> = {
  // è·¯ç·šåç¨±
  'TokyoMetro.Ginza': {
    'zh-TW': 'éŠ€åº§ç·š',
    'ja': 'éŠ€åº§ç·š',
    'en': 'Ginza Line',
  },
  'TokyoMetro.Marunouchi': {
    'zh-TW': 'ä¸¸ä¹‹å…§ç·š',
    'ja': 'ä¸¸ãƒå†…ç·š',
    'en': 'Marunouchi Line',
  },
  
  // è»Šç«™åç¨±
  'ueno': {
    'zh-TW': 'ä¸Šé‡',
    'ja': 'ä¸Šé‡',
    'en': 'Ueno',
  },
  'asakusa': {
    'zh-TW': 'æ·ºè‰',
    'ja': 'æµ…è‰',
    'en': 'Asakusa',
  },
  
  // Vibe Tags
  'shopping_paradise': {
    'zh-TW': 'è³¼ç‰©å¤©å ‚',
    'ja': 'è²·ã„ç‰©å¤©å›½',
    'en': 'Shopping Paradise',
  },
  'foodie_haven': {
    'zh-TW': 'ç¾é£Ÿæ¿€æˆ°å€',
    'ja': 'ã‚°ãƒ«ãƒ¡æ¿€æˆ¦åŒº',
    'en': 'Foodie Haven',
  },
};
```

### 5.3 ç¿»è­¯ API å‘¼å«

```typescript
// lib/i18n/translate.ts

export async function translateText(
  text: string,
  sourceLang: string,
  targetLangs: string[]
): Promise<Record<string, string>> {
  const result: Record<string, string> = { [sourceLang]: text };
  
  for (const targetLang of targetLangs) {
    if (targetLang === sourceLang) continue;
    
    // å…ˆæŸ¥å°ç…§è¡¨
    const cached = lookupProperNoun(text);
    if (cached && cached[targetLang]) {
      result[targetLang] = cached[targetLang];
      continue;
    }
    
    // å‘¼å« DeepL API
    const response = await fetch('https://api.deepl.com/v2/translate', {
      method: 'POST',
      headers: {
        'Authorization': `DeepL-Auth-Key ${process.env.DEEPL_API_KEY}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        text: [text],
        source_lang: sourceLang.toUpperCase(),
        target_lang: targetLang.toUpperCase(),
      }),
    });
    
    const data = await response.json();
    result[targetLang] = data.translations[0].text;
  }
  
  return result;
}
```

---

## 6. éŒ¯èª¤è™•ç†èˆ‡é™ç´š

### 6.1 API å¤±æ•—è™•ç†

```typescript
// L2 æ•¸æ“šæŠ“å–å¤±æ•—æ™‚çš„è™•ç†

async function fetchL2Status(nodeId: string): Promise<L2_LiveStatus | null> {
  try {
    // å˜—è©¦å¾ Redis å–å¾—æœ€æ–°æ•¸æ“š
    const cached = await redis.get(`l2:${nodeId}`);
    if (cached) {
      return JSON.parse(cached);
    }
    
    // å˜—è©¦å¾ ODPT API å–å¾—
    const fresh = await fetchFromODPT(nodeId);
    await redis.setex(`l2:${nodeId}`, 1200, JSON.stringify(fresh));
    return fresh;
    
  } catch (error) {
    console.error('L2 fetch failed:', error);
    
    // é™ç´šï¼šå˜—è©¦å–å¾—éæœŸçš„å¿«å–
    const stale = await redis.get(`l2:${nodeId}:stale`);
    if (stale) {
      return {
        ...JSON.parse(stale),
        _isStale: true,
        _staleMessage: 'è³‡æ–™æ›´æ–°æ–¼ 30 åˆ†é˜å‰',
      };
    }
    
    // å®Œå…¨ç„¡è³‡æ–™
    return null;
  }
}
```

### 6.2 UI é¡¯ç¤ºéæœŸæç¤º

```typescript
// ç•¶æ•¸æ“šéæœŸæ™‚çš„ UI è™•ç†

function renderL2Status(status: L2_LiveStatus | null) {
  if (!status) {
    return (
      <div className="status-unavailable">
        âš ï¸ å³æ™‚è³‡è¨Šæš«æ™‚ç„¡æ³•å–å¾—
      </div>
    );
  }
  
  if (status._isStale) {
    return (
      <div className="status-stale">
        <span className="stale-badge">â° {status._staleMessage}</span>
        <StatusDisplay data={status} />
      </div>
    );
  }
  
  return <StatusDisplay data={status} />;
}
```

---

*ç‰ˆæœ¬ï¼šv3.0 | æœ€å¾Œæ›´æ–°ï¼š2025-12-22*
