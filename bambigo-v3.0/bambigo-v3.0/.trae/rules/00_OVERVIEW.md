# LUTAGU 開發技術文件 v3.0
# 專案總覽與設計哲學

---

## ⚠️ 重要聲明

### 關於本文件
```
本文件是「指導原則」而非「完整規格」。

文件中的範例（車站名稱、設施類型、標籤數量）僅用於說明概念，
不是開發的全部內容。

AI 開發代理應該：
1. 理解每個設計背後的「為什麼」(Design Rationale)
2. 根據原則自行推演完整實作
3. 保留模組化擴展的彈性
4. 遇到未定義的細節時，依據原則做出合理判斷
```

### 關於品牌名稱
```
「LUTAGU」為內部開發技術代號，最終產品品牌名稱待定。

系統架構設計時應確保品牌名稱可輕易替換（配置化），
包括但不限於：
- UI 顯示文字
- AI 人格對話中的自稱
- 文件與註解
```

---

## 1. 專案定位

### 1.1 一句話定義

> **LUTAGU 是「焦慮經紀人」(Broker of Anxiety)**
> 
> 將冷冰冰的開放數據，轉譯為具備同理心的行動建議，
> 解決外國遊客在日本交通系統中的真實焦慮。

### 1.2 核心問題

```
遊客的真實困境：

「電車延誤了，我該怎麼辦？」
「這站有廁所嗎？在哪裡？」
「我帶著大行李，哪條路線比較方便？」
「下雨了，有沒有室內的替代方案？」

現有工具的不足：
- Google Maps：告訴你「怎麼走」，但不理解你的「焦慮」
- 官方 App：資訊準確但冷冰冰，語言障礙嚴重
- 旅遊攻略：靜態內容，無法回應即時狀況

LUTAGU 的差異：
- 不只給路線，還給「建議」
- 理解你的情境（下雨、趕時間、帶小孩）
- 用你的語言，用你能理解的方式
```

### 1.3 設計哲學（五大原則）

#### 原則 1：Guest-First（訪客優先）

```
90% 功能無需登入即可使用。

為什麼？
- 遊客沒有時間註冊帳號
- 遊客可能沒有穩定網路
- 降低使用門檻 = 提高採用率

實作要求：
- 預設為訪客模式
- 只有「訂閱推播」等功能需要登入
- 登入後的體驗是「加值」而非「解鎖」
```

#### 原則 2：Single Best Answer（單一最佳解）

```
永遠給出「單一最佳建議」，不讓用戶選擇困難。

為什麼？
- 遊客已經夠焦慮了，不要再給他們更多選擇
- 太多選項 = 決策癱瘓
- 專業的價值在於「替你決定」

實作要求：
- AI 輸出收斂為 1 個主要建議
- 備援方案以「或者...」帶過
- 最多 3 張 Action Cards
```

#### 原則 3：Commercial Reality（商業現實）

```
L4 建議必須包含可執行的商業導流。

為什麼？
- 這是系統營收的來源
- 導流到合作夥伴 = CPA 分潤
- 沒有商業模式的產品無法永續

合作夥伴類型：
- 叫車服務：GO Taxi、Uber Japan
- 共享移動：LUUP、Docomo Cycle
- 行李寄放：ecbo cloak
- 觀光票券：KLOOK、KKday

實作要求：
- 每個 Hub 節點定義商業導流規則
- 規則由情境觸發（延誤、下雨、擁擠）
- Deep Link 導向合作夥伴 App
```

#### 原則 4：Graceful Degradation（優雅降級）

```
服務品質隨距離遞減，但永遠不能「變磚塊」。

為什麼？
- 不可能覆蓋全日本
- 資源有限，必須集中火力
- 超出範圍時要誠實，不要裝懂

實作要求：
- 核心圈：完整 L1-L4 服務
- 緩衝圈：基本路線查詢，承認「這裡我不熟」
- 外部圈：優雅引導至 Google Maps

詳見「03_DATA_ORIGIN.md」同心圓數據策略。
```

#### 原則 5：Static Data Principle（靜態數據原則）

```
L1 標籤是「冷數據」，App 執行時只讀取、不計算。

為什麼？
- L1 標籤需要呼叫 Overpass API 計算周邊設施
- 如果每次用戶打開 App 都即時計算，載入會慢 2-3 秒
- 用戶體驗會極差，跳出率會很高

正確架構：
┌────────────────────────────────────────────┐
│  開發/維護階段                              │
│  n8n 批次 → 呼叫 API → 計算 → 多語系轉譯   │
│  → 寫入 Supabase                           │
│  頻率：每季一次（或資料有重大變化時）       │
└────────────────────────────────────────────┘
          │
          ▼ (數據已存在 DB 中)
┌────────────────────────────────────────────┐
│  App 執行階段                               │
│  讀取 DB → 直接顯示 → 不計算               │
│  延遲：< 100ms                              │
└────────────────────────────────────────────┘

詳見「03_DATA_ORIGIN.md」。
```

---

## 2. 術語對照表

### 2.1 內部術語 vs 使用者介面

| 內部術語 | Tab 名稱 | 說明 |
|----------|----------|------|
| L1 地點基因 | **DNA** | 三層結構：主類別→次類別→景點（有導航） |
| L2 即時狀態 | **LIVE** | 列車運行、天氣、警報、人潮 |
| L3 站內設施 | **FACILITY** | 兩層結構：設施類別→位置（無導航） |
| L4 行動建議 | **BAMBI** | 用戶狀態 + 路線規劃 + 專家知識 |

### 2.2 L1 與 L3 的關鍵區別

```
這是最常混淆的部分，請務必理解：

L1 DNA（周邊生活機能）
├─ 範圍：站外、周邊景點、店家
├─ 結構：三層（主類別→次類別→具體景點）
├─ 導航：✅ 有 Google Maps 導航按鈕
└─ 內容：餐廳、商店、景點、神社…

L3 FACILITY（站內設施）
├─ 範圍：站內設施
├─ 結構：兩層（設施類別→位置列表）
├─ 導航：❌ 無導航按鈕，只顯示相對位置
└─ 內容：廁所、充電、ATM、置物櫃…
```

### 2.2 技術術語

| 術語 | 定義 |
|------|------|
| Hub 母節點 | 具有完整 L1 標籤、AI 人格、商業規則的核心節點（10-15 個） |
| Spoke 子節點 | 繼承 Hub 的標籤與規則，但有獨立座標與即時狀態的子節點 |
| Zone（圈層） | 服務範圍的分級：Core / Buffer / Outer |
| Action Card | L4 建議的 UI 呈現形式，最多 3 張 |
| Trip Guard | 監控行程異常並推播替代方案的功能 |
| Deep Link | 直接開啟合作夥伴 App 特定頁面的連結 |
| Vibe Tags | 描述節點氛圍的標籤（如 #購物天堂、#結緣聖地） |

### 2.3 數據術語

| 術語 | 定義 | 更新頻率 |
|------|------|----------|
| 冷數據 (Cold) | 幾乎不變的靜態資料（L1 標籤） | 每季 |
| 溫數據 (Warm) | 偶爾變動的資料（L3 設施） | 每月 |
| 熱數據 (Hot) | 即時變動的資料（L2 狀態） | 15-20 分鐘 |

---

## 3. 文件導覽

```
lutagu-v3.0/
├── .trae/
│   └── rules/
│       ├── 00_OVERVIEW.md          ← 你正在閱讀這份
│       │   專案總覽、設計哲學、術語對照
│       │
│       ├── 01_TAGGING_SYSTEM.md
│       │   L1-L4 標籤系統統一定義
│       │   多語系規範、標籤生成規則
│       │
│       ├── 02_AI_ARCHITECTURE.md
│       │   三層 AI 混合架構（Rule/SLM/LLM）
│       │   商業導流邏輯整合
│       │
│       ├── 03_DATA_ORIGIN.md
│       │   靜態數據原則、ETL 流程
│       │   同心圓數據策略
│       │
│       ├── 04_NODE_INHERITANCE.md
│       │   母子節點繼承機制
│       │   Hub/Spoke 設計模式
│       │
│       ├── 05_DB_SCHEMA.md
│       │   資料庫結構、索引策略
│       │   多語系欄位設計
│       │
│       ├── 06_UI_SPEC.md
│       │   介面規格、降級 UI
│       │   使用者友善名稱對照
│       │
│       ├── 07_N8N_WORKFLOWS.md
│       │   自動化流程設計
│       │   合理更新頻率
│       │
│       └── 08_TECH_STACK.md
│           技術選型、模組結構
│           環境變數設定
│
├── data/
│   └── odpt_data_sources.csv
│       ODPT 開放數據源清單
│
└── README.md
    快速開始指南
```

---

## 4. 開發里程碑

### Phase 1：骨幹建置（MVP）

```
目標：可展示的最小可行產品

- [ ] 專案初始化（Next.js + Supabase）
- [ ] 建立 10-15 個 Hub 節點資料
- [ ] 實作 Zone Detector（圈層判定）
- [ ] 實作 L2 即時狀態顯示
- [ ] 實作 L3 設施查詢
- [ ] 基本 AI 對話（Rule-based 為主）
- [ ] PWA Manifest
```

### Phase 2：智慧擴展

```
目標：完整 AI 能力與商業導流

- [ ] SLM 本地部署（意圖分類）
- [ ] LLM 整合（Dify + Gemini）
- [ ] 商業導流規則實作
- [ ] Trip Guard 推播功能
- [ ] 多語系完整支援
```

### Phase 3：規模化

```
目標：擴展節點與優化體驗

- [ ] Spoke 子節點擴展
- [ ] 數據自動更新流程
- [ ] 效能優化
- [ ] 使用者回饋機制
```

---

## 5. 競賽資訊

```
日本公共交通開放數據挑戰賽 2025
(Japan Public Transportation Open Data Challenge 2025)

最終發表：2026 年 2 月 21 日（東京）

驗證場域：東京都心（台東區、千代田區、中央區）
          + 川越市（ODPT 數據完整度高）

評分重點：
1. 開放數據的創新應用
2. 解決真實問題的能力
3. 技術可行性
4. 商業可持續性
```

---

## 6. 參考資源

| 資源 | 網址 |
|------|------|
| ODPT 開發者網站 | https://developer.odpt.org/ |
| 競賽官網 | https://challenge.odpt.org/ |
| Supabase 文件 | https://supabase.com/docs |
| Dify 文件 | https://docs.dify.ai/ |
| Leaflet 文件 | https://leafletjs.com/ |

---

*版本：v3.0 | 最後更新：2025-12-22*
