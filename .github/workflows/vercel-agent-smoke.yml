name: Vercel Agent Smoke

on:
  deployment_status:

jobs:
  smoke:
    if: ${{ github.event.deployment_status.state == 'success' }}
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Env probe
        run: |
          node -e "console.log({OPENROUTER: !!process.env.OPENROUTER_API_KEY, ZEABUR: !!process.env.ZEABUR_API_KEY, E2E: !!process.env.AGENT_E2E_KEY, E2E_PROVIDER: process.env.E2E_PROVIDER})"

      - name: Smoke ping agent health
        env:
          AGENT_E2E_BASE_URL: ${{ github.event.deployment_status.target_url }}
        run: |
          echo "Health URL: ${AGENT_E2E_BASE_URL}/api/agent/health"
          curl -fsS --max-time 10 "${AGENT_E2E_BASE_URL}/api/agent/health"
