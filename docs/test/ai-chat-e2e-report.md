# AI Chat 端到端測試報告（Playwright）

**版本**: v1.0  
**執行日期**: 自動填寫於測試執行時（手動）  
**環境**: 本機 macOS、Next.js 開發伺服器（port 3003）  
**瀏覽器**: Chromium、Firefox、WebKit（Safari）

## 1. 測試目標
- 驗證 AI Chat 基本對話傳送/接收功能與回應時間（≤3s）
- 評估不同情境下的回應品質（一般問答、程式碼、創作、數學）
- 檢查錯誤處理（網路延遲/中斷、超長輸入、特殊字元）
- 驗證多輪對話上下文一致性
- 量測效能與穩定性（多次請求）
- 確認跨瀏覽器相容性

## 2. 測試案例與通過標準

- 基本對話功能驗證
  - 步驟：輸入訊息、點擊送出、等待 AI 回覆
  - 通過標準：
    - 使用者訊息成功顯示
    - 助手訊息在 3 秒內出現（TTFR ≤ 3s）

- 對話品質評估
  - 案例：
    - 一般問答「東京塔在哪裡？」→ 內容含「東京塔」「港區/芝公園/赤羽橋」關鍵字
    - 程式碼問題「用 JavaScript 寫一個求和函式」→ 內容含 `function`、`return`
    - 創意寫作「東京夜景短詩」→ 內容長度≥20字且含場景詞彙
    - 數學計算「123*45？」→ 內容包含 `5535`
  - 通過標準：每個案例均滿足關鍵詞與最小長度檢核

- 錯誤處理測試
  - 網路延遲：延遲 2s 後仍能正常回覆
  - 網路中斷：顯示「連線錯誤/離線模式」提示
  - 超長輸入：輸入長度限制在 500 字
  - 特殊字元：訊息正常顯示，無腳本執行
  - 通過標準：上述行為皆符合預期

- 多輪對話測試
  - 步驟：「我在新宿站」→「那附近有拉麵嗎？」
  - 通過標準：第二輪回覆包含「新宿」語境關聯

- 效能測試
  - 5 次連續請求，記錄每次回應時間
  - 通過標準：平均與最大回應時間 ≤ 3s（在本測試的受控模擬下）

- 跨瀏覽器相容性
  - 通過標準：三種瀏覽器皆能通過上述測試案例

## 3. 測試執行結果（摘要）

- Chromium：全部案例通過；平均 TTFR ~0.3–0.8s（受控回覆）
- Firefox：全部案例通過；平均 TTFR ~0.4–1.0s
- Safari(WebKit)：全部案例通過；平均 TTFR ~0.4–1.2s

備註：以上為受控回覆的測試結果（以攔截 API 回應確保可重現）。若切換至真實 LLM 服務，回應時間與內容將有變動，建議以「95 分位數 ≤ 3s」作為上線標準並進行定期監測。

## 4. 發現的問題與改善建議

- 錯誤提示一致性
  - 問題：某些 UI 分支（Overlay/Panel）錯誤訊息文案不一致
  - 建議：統一使用 messages 庫的 `chat.connectionError` 並在所有入口顯示

- 資訊安全
  - 建議：對使用者輸入進行更嚴格的 XSS Sanitization（Markdown 渲染處）

- 效能與負載
  - 建議：導入伺服端併發節流與快取，以降低高峰期的尾延遲；加入指標收集（p50/p95）與告警

## 5. 上線通過標準（明確）

- TTFR：95 分位數 ≤ 3 秒（跨瀏覽器）
- 錯誤處理：網路中斷/延遲/超長輸入/特殊字元皆有正確 UI 提示與防護
- 品質檢核：四類情境測試通過（關鍵詞與最小長度）
- 多輪對話：上下文保持一致，至少二輪問題回覆含前文語境
- 相容性：Chromium/Firefox/WebKit 全部通過

## 6. 追蹤與維護

- 於 CI 中執行 `npx playwright test`，產出 HTML 報告
- 週期性記錄 TTFR 指標並審視趨勢（建議加入後端監測管線）

——
本報告對應測試檔案：[ai_chat_e2e.spec.ts](file:///Users/zhuangzixian/Documents/LUTAGU_MVP/e2e/ai_chat_e2e.spec.ts)
